<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>용인 테니스 예약 현황</title>

<style>
    :root {
        --bg: #f5f5f7;
        --card: #ffffff;
        --text: #1d1d1f;
        --blue: #007aff;
        --gray: #8e8e93;
        --radius: 18px;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --text: #f5f5f7;
            --gray: #98989d;
        }
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text";
        background: var(--bg);
        margin: 0;
        padding: 0;
    }

    .navbar {
        position: sticky;
        top: 0;
        background: var(--bg);
        padding: 14px;
        font-size: 22px;
        font-weight: 700;
        color: var(--text);
        text-align: center;
        border-bottom: 1px solid rgba(0,0,0,0.08);
    }

    /* ---------- 필터 UI ---------- */
    .segment {
        display: flex;
        gap: 8px;
        margin: 14px;
    }

    .segment button {
        flex: 1;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #ccc;
        background: var(--card);
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
    }

    .segment button.active {
        background: var(--blue);
        color: white;
    }

    .filter-block {
        margin: 12px 14px;
    }

    .filter-block select {
        width: 100%;
        padding: 10px;
        border-radius: 12px;
        border: 1px solid #ccc;
    }

    /* ---------- 카드 UI ---------- */
    .court-card {
        background: var(--card);
        margin: 16px;
        padding: 18px;
        border-radius: var(--radius);
        box-shadow: 0 4px 14px rgba(0,0,0,0.08);
        transition: 0.25s ease;
    }

    .court-card:hover {
        transform: translateY(-3px);
    }

    .court-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 6px;
    }

    .court-location {
        font-size: 14px;
        color: var(--gray);
        margin-bottom: 12px;
    }

    .date-section {
        margin-bottom: 12px;
        border-radius: var(--radius);
        background: rgba(0,0,0,0.04);
        padding: 10px;
    }

    .date-header {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .time-slot {
        background: var(--card);
        border-radius: 12px;
        padding: 8px 12px;
        margin: 4px;
        display: inline-block;
        font-size: 13px;
        font-weight: 600;
        color: var(--text);
        border: 1px solid rgba(0,0,0,0.12);
    }
</style>
</head>

<body>

<div class="navbar">용인 테니스 예약 현황</div>

<!-- 구 필터 -->
<div class="segment" id="filter-gu">
    <button data-gu="all" class="active">전체</button>
    <button data-gu="처인구">처인구</button>
    <button data-gu="기흥구">기흥구</button>
    <button data-gu="수지구">수지구</button>
</div>

<!-- 날짜 필터 -->
<div class="segment" id="filter-date">
    <button data-date="tomorrow" class="active">내일</button>
    <button data-date="thisweek">이번주</button>
    <button data-date="thismonth">이번달</button>
    <button data-date="nextmonth">다음달</button>
</div>

<!-- 테니스장 필터 -->
<div class="filter-block">
    <select id="filter-court">
        <option value="all">전체 테니스장</option>
    </select>
</div>

<div id="content"></div>

<!-- -------------------- JS -------------------- -->
<script>
let FACILITIES = {};
let AVAIL = {};

async function loadData() {
    const res = await fetch("/data");
    const data = await res.json();

    FACILITIES = data.facilities;
    AVAIL = data.availability;

    const courtSelect = document.getElementById("filter-court");
    for (let rid in FACILITIES) {
        const opt = document.createElement("option");
        opt.value = rid;
        opt.textContent = FACILITIES[rid].title;
        courtSelect.appendChild(opt);
    }

    render();
}

function setActive(el) {
    const parent = el.parentElement;
    [...parent.children].forEach(btn => btn.classList.remove("active"));
    el.classList.add("active");
}

function filterByDate(days, filterType) {
    let result = {};
    const now = new Date();
    const tomorrow = new Date(now.getTime() + 86400000);
    const format = d => d.toISOString().slice(0,10).replace(/-/g,"");

    if (filterType === "tomorrow") {
        const key = format(tomorrow);
        if (days[key]) result[key] = days[key];
    }
    else if (filterType === "thisweek") {
        const end = new Date(now);
        end.setDate(now.getDate() + (7 - now.getDay()));
        for (let d = new Date(tomorrow); d <= end; d.setDate(d.getDate()+1)) {
            const key = format(d);
            if (days[key]) result[key] = days[key];
        }
    }
    else if (filterType === "thismonth") {
        const end = new Date(now.getFullYear(), now.getMonth()+1, 0);
        for (let d = new Date(tomorrow); d <= end; d.setDate(d.getDate()+1)) {
            const key = format(d);
            if (days[key]) result[key] = days[key];
        }
    }
    else if (filterType === "nextmonth") {
        const start = new Date(now.getFullYear(), now.getMonth()+1, 1);
        const end = new Date(now.getFullYear(), now.getMonth()+2, 0);
        for (let d = start; d <= end; d.setDate(d.getDate()+1)) {
            const key = format(d);
            if (days[key]) result[key] = days[key];
        }
    }

    return result;
}

function render() {
    const guFilter = document.querySelector("#filter-gu .active").dataset.gu;
    const dateFilter = document.querySelector("#filter-date .active").dataset.date;
    const courtFilter = document.getElementById("filter-court").value;

    let html = "";

    for (let rid in FACILITIES) {
        if (courtFilter !== "all" && rid !== courtFilter) continue;

        const loc = FACILITIES[rid].location || "";
        if (guFilter !== "all" && !loc.includes(guFilter)) continue;

        let days = AVAIL[rid] || {};
        let filtered = filterByDate(days, dateFilter);
        if (Object.keys(filtered).length === 0) continue;

        html += `
        <div class="court-card">
            <div class="court-title">${FACILITIES[rid].title}</div>
            <div class="court-location">${FACILITIES[rid].location}</div>
        `;

        for (let dateKey in filtered) {
            html += `
            <div class="date-section">
                <div class="date-header">${dateKey}</div>
            `;
            filtered[dateKey].forEach(t => {
                html += `<div class="time-slot">${t.timeContent}</div>`;
            });
            html += `</div>`;
        }

        html += `</div>`;
    }

    document.getElementById("content").innerHTML = html;
}

document.querySelectorAll("#filter-gu button").forEach(btn =>
    btn.addEventListener("click", () => { setActive(btn); render(); })
);

document.querySelectorAll("#filter-date button").forEach(btn =>
    btn.addEventListener("click", () => { setActive(btn); render(); })
);

document.getElementById("filter-court").addEventListener("change", render);

loadData();
</script>

</body>
</html>
