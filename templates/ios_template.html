<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>ìš©ì¸ í…Œë‹ˆìŠ¤ ì˜ˆì•½ í˜„í™©</title>

<style>
    :root {
        --accent: #3182f6; /* Toss Blue */

        --bg-light: #f9fafb;
        --text-light: #111;
        --subtext-light: #6b7280;
        --card-light: #ffffff;

        --bg-dark: #000;
        --text-dark: #f5f5f7;
        --subtext-dark: #a1a1aa;
        --card-dark: #1f1f22;

        --radius: 20px;
    }

    @media (prefers-color-scheme: light) {
        :root {
            --bg: var(--bg-light);
            --text: var(--text-light);
            --sub: var(--subtext-light);
            --card: var(--card-light);
        }
    }
    @media (prefers-color-scheme: dark) {
        :root {
            --bg: var(--bg-dark);
            --text: var(--text-dark);
            --sub: var(--subtext-dark);
            --card: var(--card-dark);
        }
    }

    body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--text);
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text";
    }

    /* ğŸ”µ ìƒë‹¨ ë„¤ë¹„ë°” */
    .navbar {
        position: sticky;
        top: 0;
        padding: 20px 0;
        font-size: 22px;
        font-weight: 700;
        text-align: center;
        background: var(--bg);
        color: var(--text);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255,255,255,0.05);
        z-index: 20;
    }

    /* ğŸ”µ Segmented Control */
    .segment {
        display: flex;
        gap: 8px;
        margin: 16px;
    }

    .segment button {
        flex: 1;
        padding: 12px;
        border-radius: 12px;
        background: var(--card);
        border: 1px solid rgba(255,255,255,0.12);
        font-size: 15px;
        font-weight: 600;
        color: var(--sub);
        transition: 0.2s ease;
    }

    .segment button.active {
        background: var(--accent);
        color: #fff;
        border: none;
        box-shadow: 0 4px 16px rgba(49,130,246,0.35);
    }

    /* ğŸ”µ ë“œë¡­ë‹¤ìš´ */
    .filter-block {
        margin: 8px 16px;
    }

    .filter-block select {
        width: 100%;
        padding: 13px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.15);
        background: var(--card);
        color: var(--text);
        font-size: 15px;
    }

    /* ğŸ”µ í…ŒìŠ¬ë¼ ìŠ¤íƒ€ì¼ ì¹´ë“œ */
    .court-card {
        background: var(--card);
        margin: 18px;
        padding: 22px;
        border-radius: var(--radius);
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
        transition: 0.2s;
    }

    .court-card:hover {
        transform: translateY(-4px);
    }

    .court-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .court-location {
        font-size: 15px;
        color: var(--sub);
        margin-bottom: 14px;
    }

    /* ë‚ ì§œ ë¸”ë¡ */
    .date-section {
        margin-top: 14px;
        padding: 14px;
        border-radius: 14px;
        background: rgba(255,255,255,0.06);
    }

    .date-header {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .time-slot {
        display: inline-block;
        margin: 4px;
        padding: 8px 14px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
    }
</style>
</head>

<body>

<div class="navbar">ìš©ì¸ í…Œë‹ˆìŠ¤ì¥ ì˜ˆì•½</div>

<!-- ğŸ”µ êµ¬ í•„í„° -->
<div class="segment" id="filter-gu">
    <button data-gu="all" class="active">ì „ì²´</button>
    <button data-gu="ì²˜ì¸êµ¬">ì²˜ì¸êµ¬</button>
    <button data-gu="ê¸°í¥êµ¬">ê¸°í¥êµ¬</button>
    <button data-gu="ìˆ˜ì§€êµ¬">ìˆ˜ì§€êµ¬</button>
</div>

<!-- ğŸ”µ ë‚ ì§œ í•„í„° -->
<div class="segment" id="filter-date">
    <button data-date="tomorrow" class="active">ë‚´ì¼</button>
    <button data-date="thisweek">ì´ë²ˆì£¼</button>
    <button data-date="thismonth">ì´ë²ˆë‹¬</button>
    <button data-date="nextmonth">ë‹¤ìŒë‹¬</button>
</div>

<!-- ğŸ”µ í…Œë‹ˆìŠ¤ì¥ í•„í„° -->
<div class="filter-block">
    <select id="filter-court">
        <option value="all">ì „ì²´ í…Œë‹ˆìŠ¤ì¥</option>
    </select>
</div>

<div id="content"></div>

<script>
let FACILITIES = {};
let AVAIL = {};

/* ğŸ”µ '20240218' â†’ '2ì›” 18ì¼ (ì¼)' ìŠ¤íƒ€ì¼ë¡œ ë³€í™˜ */
function formatKoreanDate(dateKey) {
    const y = parseInt(dateKey.substring(0, 4));
    const m = parseInt(dateKey.substring(4, 6));
    const d = parseInt(dateKey.substring(6, 8));
    const dt = new Date(y, m - 1, d);
    const weekday = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][dt.getDay()];
    return `${m}ì›” ${d}ì¼ (${weekday})`;
}

async function loadData() {
    const res = await fetch("/data");
    const data = await res.json();

    FACILITIES = data.facilities;
    AVAIL = data.availability;

    // ë“œë¡­ë‹¤ìš´ ìë™ ìƒì„±
    const courtSelect = document.getElementById("filter-court");
    for (let rid in FACILITIES) {
        const opt = document.createElement("option");
        opt.value = rid;
        opt.textContent = FACILITIES[rid].title;
        courtSelect.appendChild(opt);
    }

    render();
}

function setActive(btn) {
    const group = btn.parentElement.children;
    [...group].forEach(el => el.classList.remove("active"));
    btn.classList.add("active");
}

function filterByDate(days, filterType) {
    let result = {};
    const now = new Date();
    const tomorrow = new Date(Date.now() + 86400000);

    const fmt = d => d.toISOString().slice(0,10).replace(/-/g, "");

    if (filterType === "tomorrow") {
        const key = fmt(tomorrow);
        if (days[key]) result[key] = days[key];
    }
    else if (filterType === "thisweek") {
        const end = new Date();
        end.setDate(now.getDate() + (7 - now.getDay()));
        for (let d = new Date(tomorrow); d <= end; d.setDate(d.getDate()+1)) {
            const k = fmt(d);
            if (days[k]) result[k] = days[k];
        }
    }
    else if (filterType === "thismonth") {
        const end = new Date(now.getFullYear(), now.getMonth()+1, 0);
        for (let d = new Date(tomorrow); d <= end; d.setDate(d.getDate()+1)) {
            const k = fmt(d);
            if (days[k]) result[k] = days[k];
        }
    }
    else if (filterType === "nextmonth") {
        const start = new Date(now.getFullYear(), now.getMonth()+1, 1);
        const end = new Date(now.getFullYear(), now.getMonth()+2, 0);
        for (let d = start; d <= end; d.setDate(d.getDate()+1)) {
            const k = fmt(d);
            if (days[k]) result[k] = days[k];
        }
    }

    return result;
}

function render() {
    const gu = document.querySelector("#filter-gu .active").dataset.gu;
    const date = document.querySelector("#filter-date .active").dataset.date;
    const court = document.getElementById("filter-court").value;

    let html = "";

    for (let rid in FACILITIES) {
        if (court !== "all" && rid !== court) continue;
        const loc = FACILITIES[rid].location || "";
        if (gu !== "all" && !loc.includes(gu)) continue;

        const days = AVAIL[rid] || {};
        const filtered = filterByDate(days, date);
        if (Object.keys(filtered).length === 0) continue;

        html += `
        <div class="court-card">
            <div class="court-title">${FACILITIES[rid].title}</div>
            <div class="court-location">${FACILITIES[rid].location}</div>
        `;

        for (let dateKey in filtered) {
            html += `
            <div class="date-section">
                <div class="date-header">${formatKoreanDate(dateKey)}</div>
            `;
            filtered[dateKey].forEach(t => {
                html += `<div class="time-slot">${t.timeContent}</div>`;
            });

            html += `</div>`;
        }

        html += `</div>`;
    }

    document.getElementById("content").innerHTML = html;
}

document.querySelectorAll("#filter-gu button").forEach(btn => {
    btn.addEventListener("click", () => { setActive(btn); render(); });
});
document.querySelectorAll("#filter-date button").forEach(btn => {
    btn.addEventListener("click", () => { setActive(btn); render(); });
});
document.getElementById("filter-court").addEventListener("change", render);

loadData();
</script>

</body>
</html>
