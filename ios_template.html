<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>í…Œë‹ˆìŠ¤ ì˜ˆì•½ í˜„í™©</title>

<style>
:root {
  --bg: #f5f7fb;
  --card: #ffffff;
  --text: #111827;
  --sub: #6b7280;
  --primary: #5b6dff;
  --border: #e5e7eb;
  --radius: 18px;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
    "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
  background: linear-gradient(180deg, #eef2ff, #f9fafb);
  color: var(--text);
}

.container {
  max-width: 920px;
  margin: 0 auto;
  padding: 24px 16px 120px;
}

h1 {
  font-size: 22px;
  font-weight: 800;
  margin-bottom: 6px;
}

.sub {
  font-size: 13px;
  color: var(--sub);
  margin-bottom: 24px;
}

.card {
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: 0 10px 30px rgba(0,0,0,.08);
  padding: 20px;
  margin-bottom: 20px;
}

/* ì˜ˆì•½ í˜„í™© */
.court-card {
  margin-bottom: 22px;
}

.court-title {
  font-size: 17px;
  font-weight: 700;
}

.court-loc {
  font-size: 13px;
  color: var(--sub);
  margin-bottom: 10px;
}

.date-box {
  background: #f9fafb;
  border-radius: 14px;
  padding: 12px;
  margin-bottom: 10px;
}

.date-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 8px;
}

.slots {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.slot {
  padding: 8px 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  font-size: 13px;
  font-weight: 600;
  background: white;
}

/* ì•ŒëŒ */
.alarm-grid {
  display: grid;
  grid-template-columns: 1fr 1fr auto;
  gap: 12px;
  margin-top: 12px;
}

select, input[type="date"] {
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
  font-size: 14px;
}

button {
  padding: 12px 18px;
  border-radius: 14px;
  border: none;
  background: var(--primary);
  color: white;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
}

button:disabled {
  opacity: .6;
  cursor: not-allowed;
}

.footer {
  position: fixed;
  bottom: 16px;
  right: 16px;
  background: white;
  padding: 10px 14px;
  border-radius: 999px;
  font-size: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,.12);
}
</style>
</head>

<body>
<div class="container">

  <h1>ğŸ¾ í…Œë‹ˆìŠ¤ ì˜ˆì•½ í˜„í™©</h1>
  <div class="sub" id="updatedAt">ì—…ë°ì´íŠ¸ í™•ì¸ ì¤‘â€¦</div>

  <!-- ì˜ˆì•½ í˜„í™© -->
  <div class="card">
    <h2 style="margin-top:0">ì˜ˆì•½ ê°€ëŠ¥ í˜„í™©</h2>
    <div id="courts">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
  </div>

  <!-- ì•ŒëŒ -->
  <div class="card">
    <h2 style="margin-top:0">ğŸ”” ì•ŒëŒ ë“±ë¡</h2>
    <div class="alarm-grid">
      <select id="alarmCourt">
        <option>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</option>
      </select>
      <input type="date" id="alarmDate" />
      <button id="alarmBtn">ì•Œë¦¼ ë“±ë¡</button>
    </div>
    <div class="sub" style="margin-top:8px">
      ì˜¤ëŠ˜ ë‚ ì§œëŠ” ì œì™¸ë˜ë©°, ì´ë¯¸ ì§€ë‚œ ì•ŒëŒì€ ìë™ ì‚­ì œë©ë‹ˆë‹¤.
    </div>
  </div>

</div>

<div class="footer">ë°ì´í„° ìë™ ê°±ì‹  ì¤‘</div>

<script>
let DATA = null;

async function loadData() {
  const res = await fetch("/data");
  DATA = await res.json();

  renderUpdated();
  renderCourts();
  renderAlarmSelect();
}

function renderUpdated() {
  if (!DATA.updated_at) {
    document.getElementById("updatedAt").textContent = "ì—…ë°ì´íŠ¸ ì¤€ë¹„ ì¤‘â€¦";
    return;
  }
  const d = new Date(DATA.updated_at);
  document.getElementById("updatedAt").textContent =
    "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: " + d.toLocaleString("ko-KR");
}

function renderCourts() {
  const wrap = document.getElementById("courts");
  wrap.innerHTML = "";

  const fac = DATA.facilities;
  const avail = DATA.availability;

  for (const id in fac) {
    const days = avail[id];
    if (!days) continue;

    let hasSlot = false;
    for (const k in days) {
      if (days[k].length) hasSlot = true;
    }
    if (!hasSlot) continue;

    let html = `
      <div class="court-card">
        <div class="court-title">${fac[id].title}</div>
        <div class="court-loc">${fac[id].location || ""}</div>
    `;

    for (const date in days) {
      if (!days[date].length) continue;
      html += `<div class="date-box">
        <div class="date-title">${formatDate(date)}</div>
        <div class="slots">
      `;
      days[date].forEach(s => {
        html += `<div class="slot">${s.timeContent}</div>`;
      });
      html += `</div></div>`;
    }

    html += `</div>`;
    wrap.innerHTML += html;
  }
}

function renderAlarmSelect() {
  const sel = document.getElementById("alarmCourt");
  sel.innerHTML = `<option value="">í…Œë‹ˆìŠ¤ì¥ ì„ íƒ</option>`;
  for (const id in DATA.facilities) {
    const name = DATA.facilities[id].title.replace(/\[.*?\]/g, "").trim();
    sel.innerHTML += `<option value="${name}">${name}</option>`;
  }
}

function formatDate(str) {
  return `${str.slice(4,6)}.${str.slice(6,8)}`;
}

document.getElementById("alarmBtn").onclick = async () => {
  const court = alarmCourt.value;
  const date = alarmDate.value;
  if (!court || !date) return alert("ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”");

  await fetch("/alarm", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ court, date })
  });

  alert("ì•ŒëŒ ë“±ë¡ ì™„ë£Œ");
};

loadData();
</script>
</body>
</html>
