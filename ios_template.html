<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¾ ìš©ì¸ í…Œë‹ˆìŠ¤ ì˜ˆì•½</title>

<style>
:root{
  --bg:#f5f7fb;
  --card:#ffffff;
  --text:#111827;
  --sub:#6b7280;
  --primary:#5b6dff;
  --border:#e5e7eb;
  --radius:16px;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
  background:linear-gradient(180deg,#eef2ff,#f9fafb);
  color:var(--text);
}

.container{
  max-width:900px;
  margin:0 auto;
  padding:20px 16px 120px;
}

/* ===== íƒ€ì´í‹€ ===== */
.header{
  margin-bottom:16px;
}
.header h1{
  font-size:22px;
  font-weight:800;
  margin:0 0 4px;
}
.header .sub{
  font-size:13px;
  color:var(--sub);
}

/* ===== ê³µí†µ ì¹´ë“œ ===== */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
  margin-bottom:14px;
}

/* ===== í•„í„° ì˜ì—­ ===== */
.filter-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.filter-grid select,
.filter-grid input{
  padding:12px;
  border-radius:12px;
  border:1px solid var(--border);
  font-size:14px;
}

/* ===== ì•ŒëŒ ===== */
.alarm-row{
  display:grid;
  grid-template-columns:1fr 1fr auto;
  gap:10px;
  margin-top:10px;
}
button{
  padding:12px 16px;
  border-radius:12px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:700;
  font-size:14px;
  cursor:pointer;
}

/* ===== ë°ì´í„° ===== */
.court-card{
  margin-bottom:20px;
}
.court-title{
  font-size:16px;
  font-weight:700;
}
.court-loc{
  font-size:13px;
  color:var(--sub);
  margin-bottom:8px;
}
.date-box{
  background:#f9fafb;
  border-radius:12px;
  padding:10px;
  margin-bottom:8px;
}
.date-title{
  font-size:14px;
  font-weight:600;
  margin-bottom:6px;
}
.slots{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.slot{
  padding:7px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:13px;
  background:#fff;
}

/* ===== í•˜ë‹¨ ===== */
.footer{
  position:fixed;
  bottom:14px;
  right:14px;
  background:#fff;
  padding:8px 14px;
  border-radius:999px;
  font-size:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
}
</style>
</head>

<body>
<div class="container">

  <!-- ===== íƒ€ì´í‹€ ===== -->
  <div class="header">
    <h1>ğŸ¾ ìš©ì¸ í…Œë‹ˆìŠ¤ ì˜ˆì•½</h1>
    <div class="sub" id="updatedAt">ì—…ë°ì´íŠ¸ í™•ì¸ ì¤‘â€¦</div>
  </div>

  <!-- ===== í•„í„° + ì•ŒëŒ (ë¬´ì¡°ê±´ ìƒë‹¨) ===== -->
  <div class="card">
    <h3 style="margin:0 0 10px">í•„í„°</h3>
    <div class="filter-grid">
      <select id="filterGu">
        <option value="">êµ¬ ì „ì²´</option>
        <option>ì²˜ì¸êµ¬</option>
        <option>ê¸°í¥êµ¬</option>
        <option>ìˆ˜ì§€êµ¬</option>
      </select>

      <select id="filterCourt">
        <option value="">ì½”íŠ¸ ì „ì²´</option>
      </select>

      <input type="date" id="filterDate">
    </div>

    <hr style="border:none;border-top:1px solid var(--border);margin:14px 0">

    <h3 style="margin:0 0 8px">ğŸ”” ì•ŒëŒ</h3>
    <div class="alarm-row">
      <select id="alarmCourt">
        <option value="">ì½”íŠ¸ ì„ íƒ</option>
      </select>
      <input type="date" id="alarmDate">
      <button id="alarmBtn">ë“±ë¡</button>
    </div>
    <div class="sub" style="margin-top:6px">
      ì•ŒëŒ ë“±ë¡ ì‹œì  ì´í›„ ìƒˆë¡œ ì—´ë¦° ì‹œê°„ë§Œ ì•Œë¦¼
    </div>
  </div>

  <!-- ===== ì˜ˆì•½ ë°ì´í„° (ë§¨ ì•„ë˜) ===== -->
  <div class="card">
    <h3 style="margin-top:0">ì˜ˆì•½ ê°€ëŠ¥ í˜„í™©</h3>
    <div id="courts">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
  </div>

</div>

<div class="footer">ìë™ ê°±ì‹  ì¤‘</div>

<script>
let DATA;

async function loadData(){
  const res = await fetch("/data");
  DATA = await res.json();
  renderUpdated();
  buildCourtOptions();
  renderCourts();
}

function renderUpdated(){
  if(!DATA.updated_at){
    updatedAt.textContent="ì—…ë°ì´íŠ¸ ì¤€ë¹„ ì¤‘â€¦";
    return;
  }
  updatedAt.textContent="ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: "+DATA.updated_at;
}

function buildCourtOptions(){
  filterCourt.innerHTML='<option value="">ì½”íŠ¸ ì „ì²´</option>';
  alarmCourt.innerHTML='<option value="">ì½”íŠ¸ ì„ íƒ</option>';
  Object.values(DATA.facilities).forEach(f=>{
    const name=f.title.replace(/\[.*?\]/g,"").trim();
    filterCourt.innerHTML+=`<option>${name}</option>`;
    alarmCourt.innerHTML+=`<option>${name}</option>`;
  });
}

function renderCourts(){
  courts.innerHTML="";
  for(const id in DATA.facilities){
    const fac=DATA.facilities[id];
    const days=DATA.availability[id];
    if(!days) continue;

    let html=`<div class="court-card">
      <div class="court-title">${fac.title}</div>
      <div class="court-loc">${fac.location||""}</div>`;

    for(const d in days){
      if(!days[d].length) continue;
      html+=`<div class="date-box">
        <div class="date-title">${d.slice(4,6)}.${d.slice(6,8)}</div>
        <div class="slots">`;
      days[d].forEach(s=>{
        html+=`<div class="slot">${s.timeContent}</div>`;
      });
      html+=`</div></div>`;
    }
    html+=`</div>`;
    courts.innerHTML+=html;
  }
}

alarmBtn.onclick=async()=>{
  if(!alarmCourt.value||!alarmDate.value){
    alert("ì½”íŠ¸ì™€ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”");
    return;
  }
  await fetch("/alarm/add",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      court_group:alarmCourt.value,
      date:alarmDate.value
    })
  });
  alert("ì•ŒëŒ ë“±ë¡ ì™„ë£Œ");
};

loadData();
</script>
</body>
</html>
